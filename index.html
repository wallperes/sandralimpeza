<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sandra | Gest√£o de Limpezas Airbnb</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Bibliotecas para gerar PDF Nativo (Textos Selecion√°veis) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0d9488;
            --primary-light: #14b8a6;
            --secondary: #0f172a;
            --bg-color: #f8fafc;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            -webkit-tap-highlight-color: transparent;
            color: #334155;
        }
        .font-title { font-family: 'Playfair Display', serif; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        
        /* Ocultar scrollbar */
        ::-webkit-scrollbar { display: none; }
        
        textarea {
            resize: none;
            overflow: hidden;
            min-height: 50px;
        }

        .input-base {
            width: 100%;
            padding: 0.875rem;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            background-color: #ffffff;
            font-size: 0.9375rem;
            color: #1e293b;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.02);
        }
        .input-base:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.15);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 14px rgba(13, 148, 136, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-2px);
            background: var(--primary-light);
            box-shadow: 0 6px 20px rgba(13, 148, 136, 0.35);
        }
    </style>
</head>
<body class="pb-24">

    <!-- Navega√ß√£o Superior -->
    <nav class="sticky top-0 z-50 glass border-b border-slate-200 px-4 py-3 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-teal-600 rounded-full flex items-center justify-center text-white font-title text-xl shadow-inner">S</div>
            <div>
                <h1 class="font-bold text-slate-800 leading-none text-lg">Sandra</h1>
                <p class="text-[10px] uppercase tracking-widest text-teal-600 font-bold">Hospitalidade & Brilho</p>
            </div>
        </div>
        <div id="save-indicator" class="text-[10px] bg-teal-50 text-teal-700 px-2 py-1 rounded-full font-bold opacity-0 transition-opacity border border-teal-100">Salvo ‚úì</div>
    </nav>

    <!-- App Container -->
    <main id="app-content" class="max-w-md mx-auto px-4 pt-6">
        
        <!-- Ecr√£ de Boas-vindas -->
        <section id="welcome-screen" class="space-y-6 animate-fade-in">
            <div class="bg-white rounded-3xl p-8 shadow-sm border border-slate-200 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1.5 h-full bg-teal-500"></div>
                <h2 class="font-title text-2xl text-slate-800 mb-4 mt-2">Ol√°, eu sou a Sandra! </h2>
                <p class="text-slate-600 leading-relaxed text-sm mb-4">
                    Muito prazer em receber voc√™ aqui. Com a minha experi√™ncia no cuidado e limpeza de im√≥veis de temporada, aprendi que a higieniza√ß√£o √© o cora√ß√£o de uma avalia√ß√£o 5 estrelas.
                </p>
                <p class="text-slate-600 leading-relaxed text-sm">
                    Criei esta ficha para entender cada detalhe do seu espa√ßo. Sei que s√£o v√°rias perguntas, mas as respostas permitem registrar o seu padr√£o de trabalho e garantir que tudo saia exatamente como voc√™ gosta. Quando puder, preencha com calma e me envie a Ficha que ser√° gerada por WhatsApp. Obrigada pela confian√ßa! 
                </p>
            </div>
            
            <button onclick="navigate('ficha')" class="w-full btn-primary py-4 rounded-2xl flex items-center justify-center gap-2 text-lg">
                 Come√ßar Ficha do Im√≥vel
            </button>
            <button onclick="navigate('agenda')" class="w-full bg-white text-teal-700 border-2 border-teal-600 py-4 rounded-2xl font-bold active:scale-95 transition-transform flex items-center justify-center gap-2 text-lg hover:bg-teal-50">
                 J√° sou cliente, Agendar
            </button>
        </section>

        <!-- M√≥dulo 1: Ficha T√©cnica (Wizard) -->
        <section id="ficha-module" class="hidden animate-fade-in">
            <!-- Progress Bar -->
            <div class="mb-8">
                <div class="flex justify-between text-xs font-bold text-slate-400 uppercase mb-2">
                    <span id="step-label">Passo 1 de 6</span>
                    <span id="step-percent" class="text-teal-600">15%</span>
                </div>
                <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-teal-500 transition-all duration-500" style="width: 15%"></div>
                </div>
            </div>

            <form id="form-ficha" class="space-y-6 bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                <!-- Passo 1: Identifica√ß√£o -->
                <div class="wizard-step" data-step="1">
                    <h3 class="text-xl font-title text-slate-800 mb-4 border-b border-slate-100 pb-3">Identifica√ß√£o do Im√≥vel </h3>
                    <div class="bg-amber-50 border border-amber-200 p-4 mb-6 rounded-xl">
                        <p class="text-xs text-amber-800 font-medium"><span class="font-bold"> Dica:</span> Caso n√£o saiba o CEP, ignore esse campo e continue preenchendo o restante da ficha. Se souber, o endere√ßo ser√° preenchido automaticamente!</p>
                    </div>
                    <div class="space-y-5">
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">CEP</label>
                            <input type="tel" name="cep" id="cep" placeholder="00000-000" class="input-base" oninput="let v=this.value.replace(/\D/g,''); if(v.length===8) checkCep(v); saveData();">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Logradouro (Rua, Avenida, etc.)</label>
                            <input type="text" name="rua" id="rua" class="input-base">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Bairro</label>
                                <input type="text" name="bairro" id="bairro" class="input-base">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Cidade / UF</label>
                                <input type="text" name="cidade" id="cidade" class="input-base">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">N√∫mero </label>
                                <input type="text" name="numero" class="input-base">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Complemento (Casa, Apto...)</label>
                                <input type="text" name="complemento" class="input-base">
                            </div>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Qual √© o nome do Edif√≠cio ou Condom√≠nio?  (Ex: Rio Wonder)</label>
                            <input type="text" name="edificio" class="input-base">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Qual o nome do propriet√°rio ou respons√°vel por esse im√≥vel? </label>
                            <input type="text" name="proprietario" class="input-base">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Como √© a configura√ß√£o do seu im√≥vel? Quantos quartos, banheiros e varandas ele possui? (Se for Studio, basta escrever 'Studio') </label>
                            <textarea name="configuracao" rows="2" class="input-base"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Passo 2: Equipamentos -->
                <div class="wizard-step hidden" data-step="2">
                    <h3 class="text-xl font-title text-slate-800 mb-4 border-b border-slate-100 pb-3">Equipamentos e Materiais </h3>
                    <div class="space-y-5">
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">A√≠ no apartamento tem um aspirador de p√≥ funcionando direitinho? Ah, e a voltagem das tomadas √© 110v ou 220v? </label>
                            <textarea name="aspirador" rows="2" class="input-base"></textarea>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Posso contar com vassoura, rodo, balde, panos e escadinha a√≠ no apto?</label>
                            <textarea name="materiais_basicos" rows="2" class="input-base"></textarea>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Sobre os produtos de limpeza: prefere que eu use o meu kit ou voc√™ fornece? Se voc√™ deixa os produtos, h√° alguma instru√ß√£o especial de como gosta que os use? Ex: 'Tenho um Cheirinho de Ambiente espec√≠fico que deixo a√≠. Pe√ßo que passe o spray nas roupas de cama e cortinas'</label>
                            <textarea name="produtos_instrucao" rows="2" class="input-base"></textarea>
                        </div>
                        <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                            <label class="block text-sm font-bold text-red-700 mb-2">IMPORTANTE: tem algum produto que √© PROIBIDO ou que n√£o queira que seja usado nos pisos, nas bancadas ou nos m√≥veis? </label>
                            <textarea name="proibidos" rows="2" class="input-base border-red-200 focus:border-red-500 focus:ring-red-500 bg-white text-red-900"></textarea>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">E sobre os ventiladores: tem ventilador de teto? Se sim, quantos? E de ch√£o, tem algum? </label>
                            <input type="text" name="ventiladores" class="input-base">
                        </div>
                    </div>
                </div>

                <!-- Passo 3: Quartos -->
                <div class="wizard-step hidden" data-step="3">
                    <h3 class="text-xl font-title text-slate-800 mb-4 border-b border-slate-100 pb-3">Quartos e Roupa de Cama </h3>
                    <div class="space-y-5">
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Onde voc√™ costuma guardar as roupas de cama e banho limpas? </label>
                            <input type="text" name="guarda_enxoval" class="input-base">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Onde deixo a roupa suja que os h√≥spedes usaram?</label>
                            <input type="text" name="roupa_suja" class="input-base">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Como voc√™ prefere que eu monte as camas? Quantos travesseiros? Edredom? Len√ßol de el√°stico? Pe√ßo para me contar com detalhes como √© sua forma de trabalho.</label>
                            <textarea name="montagem_camas" rows="3" class="input-base"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Passo 4: Banheiros -->
                <div class="wizard-step hidden" data-step="4">
                    <h3 class="text-xl font-title text-slate-800 mb-4 border-b border-slate-100 pb-3">Banheiros e Amenities </h3>
                    <div class="space-y-5">
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Para o sabonete, shampoo e condicionador: voc√™ oferece? Quais oferece e onde ficam os itens de reposi√ß√£o? </label>
                            <textarea name="amenities" rows="2" class="input-base"></textarea>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Onde voc√™ prefere que eu deixe as toalhas limpas? (Em cima da cama, no rack do banheiro...)</label>
                            <input type="text" name="toalhas_posicao" class="input-base">
                        </div>
                    </div>
                </div>

                <!-- Passo 5: Cozinha -->
                <div class="wizard-step hidden" data-step="5">
                    <h3 class="text-xl font-title text-slate-800 mb-4 border-b border-slate-100 pb-3">Cozinha e Geladeira </h3>
                    <div class="space-y-5">
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Se tiver sobrado comida ou bebida dos h√≥spedes anteriores na geladeira, o que eu fa√ßo? Jogo tudo fora ou mantenho o que estiver fechado/lacrado? </label>
                            <textarea name="sobras_geladeira" rows="2" class="input-base"></textarea>
                        </div>

                        <div class="bg-slate-50 p-5 rounded-2xl border border-slate-200">
                            <label class="block text-sm font-bold text-slate-800 mb-4">Quais eletrodom√©sticos e equipamentos ficam dispon√≠veis na cozinha para os h√≥spedes? Pode marcar tudo o que tiver na casa: </label>
                            <div class="grid grid-cols-2 gap-3 text-sm text-slate-700">
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Fog√£o tradicional" class="accent-teal-600"> Fog√£o</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Cooktop" class="accent-teal-600"> Cooktop</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Forno (el√©trico/g√°s)" class="accent-teal-600"> Forno</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Micro-ondas" class="accent-teal-600"> Micro-ondas</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Airfryer" class="accent-teal-600"> Airfryer</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Panela el√©trica arroz" class="accent-teal-600"> Pan. Arroz</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Panela press√£o el√©trica" class="accent-teal-600"> Pan. Press√£o</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Filtro / Purificador" class="accent-teal-600"> Filtro</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Coifa / Exaustor" class="accent-teal-600"> Coifa</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Sanduicheira / Grill" class="accent-teal-600"> Sanduicheira</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Liquidificador" class="accent-teal-600"> Liquidificador</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Cafeteira" class="accent-teal-600"> Cafeteira</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Torradeira" class="accent-teal-600"> Torradeira</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Chaleira el√©trica" class="accent-teal-600"> Chaleira el√©t.</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Batedeira" class="accent-teal-600"> Batedeira</label>
                                <label class="flex items-center gap-2"><input type="checkbox" name="equip" value="Lava-lou√ßas" class="accent-teal-600"> Lava-lou√ßas</label>
                            </div>
                            <div class="mt-5 pt-4 border-t border-slate-200">
                                <label class="block text-xs font-bold text-slate-500 mb-2 uppercase tracking-wider">Outros equipamentos?</label>
                                <input type="text" name="equip_outros" placeholder="Ex: Nespresso, Espremedor..." class="input-base">
                            </div>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Para a gente manter o controle: voc√™ deixa um n√∫mero exato de pratos, copos e talheres (facas, garfos, colheres de sopa e de sobremesa)? Se sim, me passa as quantidades para eu conferir na hora da limpeza e te avisar se faltar algo! üçΩÔ∏è</label>
                            <input type="text" name="quantidades_louca" class="input-base">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Tem mais algum detalhe na cozinha que eu deva deixar para os h√≥spedes (sal, a√ßucar) ou algo que queira me contar?</label>
                            <textarea name="cozinha_extras" rows="2" class="input-base"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Passo 6: Finaliza√ß√£o -->
                <div class="wizard-step hidden" data-step="6">
                    <h3 class="text-xl font-title text-slate-800 mb-4 border-b border-slate-100 pb-3">Finaliza√ß√£o e Detalhes </h3>
                    <div class="space-y-5">
                        
                        <!-- SESS√ÉO DE SUJEIRA EXTREMA -->
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">E sobre lou√ßa em excesso ou sujeira em excesso deixada pelos h√≥spedes (lixo espalhado, manchas, desordem)? </label>
                            <div class="bg-amber-50 p-3 rounded-xl border border-amber-200 mb-3">
                                <p class="text-[12px] text-amber-900 leading-relaxed">
                                    <strong>Importante:</strong> O valor da limpeza cobre a prepara√ß√£o padr√£o do im√≥vel, n√£o contemplando sujeira excessiva em nenhum c√¥modo (o padr√£o Airbnb, por exemplo, exige que o h√≥spede mantenha a ordem b√°sica e lave o excesso da lou√ßa). Caso a sujeira seja excessiva, ser√° necess√°rio cobrar um adicional pelo tempo extra de trabalho. 
                                </p>
                            </div>
                            <select name="sujeira_extrema" class="input-base bg-white text-sm">
                                <option value="">Selecione a prefer√™ncia...</option>
                                <option value="Apenas tirar fotos para cobrar do h√≥spede na plataforma">Me avise e mande fotos/v√≠deos antes de come√ßar (para eu cobrar do h√≥spede)</option>
                                <option value="Limpar tudo (Aceito pagar taxa extra pelo esfor√ßo/tempo)">Me avise e mande fotos/v√≠deos, mas pode limpar tudo e cobrar o adicional pelo seu tempo extra</option>
                                <option value="Fazer apenas o padr√£o e fotografar o restante">Limpe apenas o b√°sico e me mande fotos/v√≠deos do que ficou para eu resolver</option>
                            </select>
                        </div>

                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Se houver mimos de boas vindas, (chocolates, biscoitos, etc) onde ficam guardados? </label>
                            <input type="text" name="mimos" class="input-base">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Ao terminar e fechar a porta, como devo deixar o ambiente? (Ex: cortinas abertas ou fechadas, luzes acessas ou apagadas?) üå¨Ô∏è</label>
                            <textarea name="fechamento" rows="2" class="input-base"></textarea>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Onde eu fa√ßo o descarte final de todo o lixo a√≠ no pr√©dio? üóëÔ∏è</label>
                            <input type="text" name="lixo_descarte" class="input-base">
                        </div>
                        <div class="group">
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Deseja acrescentar alguma observa√ß√£o importante ou detalhe que ainda n√£o conversamos? </label>
                            <textarea name="obs_finais" rows="3" class="input-base"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Navega√ß√£o do Wizard -->
                <div class="flex gap-3 pt-6">
                    <button type="button" id="prevBtn" onclick="changeStep(-1)" class="hidden flex-[1] bg-slate-100 text-slate-600 py-4 rounded-2xl font-bold transition-all hover:bg-slate-200">Voltar</button>
                    <button type="button" id="nextBtn" onclick="changeStep(1)" class="flex-[2] btn-primary py-4 rounded-2xl font-bold text-lg">Pr√≥ximo Passo</button>
                    <button type="button" id="submitFicha" onclick="generateReport('ficha')" class="hidden flex-[2] btn-primary py-4 rounded-2xl font-bold text-lg"> Gerar PDF</button>
                </div>
            </form>
        </section>

        <!-- M√≥dulo 2: Agendar Limpeza -->
        <section id="agenda-module" class="hidden animate-fade-in">
            <h3 class="text-xl font-title text-slate-800 mb-5 px-1">Solicita√ß√£o de Limpeza </h3>
            
            <!-- CALEND√ÅRIO -->
            <div class="mb-6 bg-white p-2 rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="px-3 py-3 bg-slate-50 rounded-t-2xl mb-2 border-b border-slate-100">
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-wider mb-2">Disponibilidade na Agenda</p>
                    <p class="text-[13px] text-slate-600 leading-snug">
                         Para verificar outras semanas ou datas, clique nas setinhas para <strong>&lt; (esquerda)</strong> ou <strong>&gt; (direita)</strong> na parte superior do calend√°rio.
                    </p>
                </div>
                <iframe src="https://calendar.google.com/calendar/embed?src=sandramjo26%40gmail.com&mode=WEEK&ctz=America%2FSao_Paulo" style="border: 0" width="100%" height="550" frameborder="0" scrolling="no"></iframe>
            </div>

            <form id="form-agenda" class="space-y-5 bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Me tira uma d√∫vida r√°pida: j√° fez a Ficha do Im√≥vel desse seu im√≥vel antes, ou √© a nossa primeira vez l√°? </label>
                    <select name="cliente_tipo" class="input-base bg-white">
                        <option value="">Selecione...</option>
                        <option value="J√° fizemos a Ficha">J√° fizemos a Ficha do Im√≥vel</option>
                        <option value="Primeira vez">√â a nossa primeira vez</option>
                    </select>
                </div>

                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Me informe o condom√≠nio, torre e o n√∫mero do apartamento  (Ex: Torre Formosa, Apto 509)</label>
                    <input type="text" name="condominio_torre" class="input-base">
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="group">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Qual √© a data gostaria de reservar? üóìÔ∏è‚úÖ</label>
                        <input type="date" name="data_limpeza" class="input-base text-slate-600">
                    </div>
                    <div class="group">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Qual o hor√°rio? </label>
                        <input type="text" name="horario_limpeza" placeholder="Ex: 11h √†s 14h" class="input-base">
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 border-l-4 border-l-blue-400">
                    <p class="text-xs text-blue-800 leading-relaxed"> <strong>Aviso:</strong> √â desej√°vel dispor de 3 horas para uma limpeza com nosso padr√£o de qualidade. No entanto, √© poss√≠vel realizar em 2 horas caso seja necess√°rio.</p>
                </div>

                <!-- NOVA PERGUNTA: CHECK-OUT -->
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Tem h√≥spedes saindo no mesmo dia da faxina (check-out)?</label>
                    <select name="tem_checkout" onchange="toggleCheckout(this.value)" class="input-base bg-white">
                        <option value="N√£o">N√£o, o apartamento j√° est√° vazio</option>
                        <option value="Sim">Sim, saem no mesmo dia</option>
                    </select>
                </div>

                <!-- CAMPO ESCONDIDO: HOR√ÅRIO CHECK-OUT -->
                <div id="checkout-time-box" class="hidden animate-fade-in group">
                    <label class="block text-sm font-bold text-teal-600 mb-2">Qual √© o hor√°rio limite de sa√≠da (check-out) dos h√≥spedes anteriores?</label>
                    <input type="text" name="horario_checkout" placeholder="Ex: 11:00" class="input-base border-teal-200 focus:border-teal-500 bg-teal-50/30">
                </div>

                <!-- PERGUNTA EXISTENTE: CHECK-IN -->
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Entrar√£o novos h√≥spedes no mesmo dia dessa solicita√ß√£o de limpeza? </label>
                    <select name="tem_checkin" onchange="toggleCheckin(this.value)" class="input-base bg-white">
                        <option value="N√£o">N√£o, o apartamento ficar√° vazio</option>
                        <option value="Sim">Sim, entram no mesmo dia</option>
                    </select>
                </div>

                <div id="checkin-time-box" class="hidden animate-fade-in group">
                    <label class="block text-sm font-bold text-teal-600 mb-2">Qual o hor√°rio previsto de entrada (check-in) dos novos h√≥spedes? </label>
                    <input type="text" name="horario_checkin" placeholder="Ex: 15:00" class="input-base border-teal-200 focus:border-teal-500 bg-teal-50/30">
                </div>

                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Como vai ser a minha entrada no dia dessa limpeza? üîë (Chave na portaria, senha na porta, cofre...) e se for senha, qual a senha?</label>
                    <textarea name="entrada_metodo" rows="2" class="input-base"></textarea>
                </div>
                
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Quantas pessoas entram nessa reserva? üë• (Pergunto s√≥ para eu ter uma ideia do que ser√° necess√°rio preparar)</label>
                    <input type="number" name="num_pessoas" class="input-base">
                </div>

                <!-- NOVA PERGUNTA: ANIMAL DE ESTIMA√á√ÉO -->
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Houve algum animal de estima√ß√£o hospedado na √∫ltima reserva? (Se sim, isso me ajuda a planejar tempo extra para o seu im√≥vel).</label>
                    <input type="text" name="teve_pet" placeholder="Ex: N√£o / Sim, um cachorro" class="input-base">
                </div>
                
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Quantas toalhas de banho e de rosto eu devo separar no total? üõÅ</label>
                    <input type="text" name="toalhas_reserva" class="input-base">
                </div>

                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Quantas camas eu preciso preparar dessa vez? E deixo quantos travesseiros e cobertores? Pe√ßo que me fale tudo sobre as roupas de cama, incluindo se devo usar cobre leitos, edredoms, etc üõèÔ∏è</label>
                    <textarea name="camas_preparo" rows="2" class="input-base"></textarea>
                </div>
                
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Quantos rolos de papel higi√™nico, sabonetes e shampoos eu devo deixar no total? üßªüß¥</label>
                    <input type="text" name="reposicao_banho" class="input-base">
                </div>
                
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Tem algum 'mimo' especial para essa reserva (chocolates, biscoitos, c√°psulas de caf√©)? Quantos eu deixo preparados? üç¨</label>
                    <input type="text" name="reposicao_mimos" class="input-base">
                </div>

                <!-- NOVA PERGUNTA: V√çDEO PROVA DE LIMPEZA -->
                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Ao final, sempre fa√ßo um v√≠deo de ‚ÄúProva de Limpeza‚Äù para te blindar contra falsas reclama√ß√µes. Tem algum detalhe que algum h√≥spede j√° usou no passado para pedir desconto e que voc√™ quer que eu foque na filmagem para sua tranquilidade?</label>
                    <textarea name="foco_video" rows="2" class="input-base"></textarea>
                </div>

                <div class="group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Para fecharmos a solicita√ß√£o: deseja acrescentar alguma observa√ß√£o importante ou pedido especial para essa limpeza que ainda n√£o conversamos? Pode me falar que dependendo do que for eu tento verificar! üòâ‚ú®</label>
                    <textarea name="obs_agendamento" rows="2" class="input-base"></textarea>
                </div>

                <button type="button" onclick="generateReport('agenda')" class="w-full btn-primary py-4 rounded-2xl mt-4 text-lg"> Gerar PDF</button>
            </form>
        </section>
    </main>

    <!-- Barra de Navega√ß√£o Inferior -->
    <div id="bottom-nav" class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-md hidden z-40">
        <div class="glass border border-white/50 shadow-xl rounded-2xl p-2 flex gap-1 bg-white/80">
            <button onclick="navigate('home')" id="nav-home" class="flex-1 flex flex-col items-center py-2.5 rounded-xl transition-colors text-slate-400 hover:bg-slate-50">
                <span class="text-[10px] font-bold uppercase mt-1">In√≠cio</span>
            </button>
            <button onclick="navigate('ficha')" id="nav-ficha" class="flex-1 flex flex-col items-center py-2.5 rounded-xl transition-colors text-slate-400 hover:bg-slate-50">
                <span class="text-[10px] font-bold uppercase mt-1">Ficha</span>
            </button>
            <button onclick="navigate('agenda')" id="nav-agenda" class="flex-1 flex flex-col items-center py-2.5 rounded-xl transition-colors text-slate-400 hover:bg-slate-50">
                <span class="text-[10px] font-bold uppercase mt-1">Agendar</span>
            </button>
        </div>
    </div>

    <!-- Modal de Carregamento & Sucesso (Estilo WhatsApp Share) -->
    <div id="loading-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[100] hidden flex flex-col items-center justify-center p-6 text-white text-center">
        <div id="loading-state" class="flex flex-col items-center">
            <div class="w-14 h-14 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mb-6"></div>
            <p class="font-bold text-xl">Gerando PDF...</p>
            <p class="text-sm text-slate-300 mt-2">Formatando documento profissional</p>
        </div>
        <div id="success-state" class="hidden flex-col items-center w-full max-w-sm">
            <div class="w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center text-3xl mb-4 shadow-lg shadow-teal-500/30">‚úì</div>
            <h3 class="text-2xl font-bold mb-2">PDF Pronto!</h3>
            <div class="bg-white/10 text-white p-4 rounded-xl border border-white/20 w-full mb-6 text-sm backdrop-blur-md">
                Lembre-se de enviar o arquivo para <strong>Sandra: (21) 96929-3505</strong>
            </div>
            <button id="btn-final-share" class="w-full py-4 rounded-2xl font-bold text-lg shadow-xl flex items-center justify-center gap-3 mb-4 transition-transform active:scale-95" style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);">
                <svg width="24" height="24" fill="white" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.63 1.433h.005c6.554 0 11.89-5.335 11.893-11.892a11.826 11.826 0 00-3.483-8.417"/></svg>
                Enviar PDF por WhatsApp
            </button>
            <button onclick="closeModal()" class="text-slate-300 text-sm py-2 hover:text-white transition-colors">Voltar e editar</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 6;
        const storageKey = 'sandra_app_data';

        window.onload = () => {
            loadSavedData();
            document.querySelectorAll('input, textarea, select').forEach(el => {
                el.addEventListener('input', saveData);
                if(el.tagName.toLowerCase() === 'textarea') {
                    el.addEventListener('input', function() {
                        this.style.height = 'auto';
                        this.style.height = (this.scrollHeight) + 'px';
                    });
                    if(el.value) { el.style.height = 'auto'; el.style.height = (el.scrollHeight) + 'px'; }
                }
            });
        };

        function navigate(page) {
            const screens = ['welcome-screen', 'ficha-module', 'agenda-module'];
            screens.forEach(s => document.getElementById(s).classList.add('hidden'));
            document.getElementById('bottom-nav').classList.remove('hidden');

            if(page === 'home') {
                document.getElementById('welcome-screen').classList.remove('hidden');
                updateNavIcons('home');
            } else {
                document.getElementById(`${page}-module`).classList.remove('hidden');
                updateNavIcons(page);
            }
            window.scrollTo(0,0);
        }

        function updateNavIcons(page) {
            const btns = ['nav-home', 'nav-ficha', 'nav-agenda'];
            btns.forEach(b => {
                const el = document.getElementById(b);
                if(el) {
                    el.classList.remove('text-teal-600');
                    el.classList.add('text-slate-400');
                }
            });
            const active = document.getElementById(`nav-${page}`);
            if(active) {
                active.classList.remove('text-slate-400');
                active.classList.add('text-teal-600');
            }
        }

        function changeStep(n) {
            const steps = document.querySelectorAll('.wizard-step');
            steps[currentStep-1].classList.add('hidden');
            currentStep += n;
            steps[currentStep-1].classList.remove('hidden');

            document.getElementById('prevBtn').classList.toggle('hidden', currentStep === 1);
            document.getElementById('nextBtn').classList.toggle('hidden', currentStep === totalSteps);
            document.getElementById('submitFicha').classList.toggle('hidden', currentStep !== totalSteps);
            
            const percent = Math.round((currentStep / totalSteps) * 100);
            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('step-label').innerText = `Passo ${currentStep} de ${totalSteps}`;
            document.getElementById('step-percent').innerText = `${percent}%`;
            window.scrollTo(0,0);
        }

        function toggleCheckin(val) { document.getElementById('checkin-time-box').classList.toggle('hidden', val !== 'Sim'); }
        // Nova fun√ß√£o para toggle do checkout
        function toggleCheckout(val) { document.getElementById('checkout-time-box').classList.toggle('hidden', val !== 'Sim'); }

        async function checkCep(cep) {
            try {
                const res = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await res.json();
                if(!data.erro) {
                    document.getElementById('rua').value = data.logradouro || '';
                    document.getElementById('bairro').value = data.bairro || '';
                    document.getElementById('cidade').value = `${data.localidade || ''} - ${data.uf || ''}`;
                    saveData();
                }
            } catch(e) { console.error("CEP error"); }
        }

        function saveData() {
            const formData = {};
            const inputs = document.querySelectorAll('#form-ficha input, #form-ficha textarea, #form-ficha select, #form-agenda input, #form-agenda textarea, #form-agenda select');
            inputs.forEach(input => {
                if(input.type === 'checkbox') {
                    if(!formData[input.name]) formData[input.name] = [];
                    if(input.checked) formData[input.name].push(input.value);
                } else { formData[input.name] = input.value; }
            });
            localStorage.setItem(storageKey, JSON.stringify(formData));
            
            const indicator = document.getElementById('save-indicator');
            indicator.style.opacity = '1';
            clearTimeout(window.saveTimeout);
            window.saveTimeout = setTimeout(() => indicator.style.opacity = '0', 2000);
        }

        function loadSavedData() {
            const saved = localStorage.getItem(storageKey);
            if(!saved) return;
            const data = JSON.parse(saved);
            Object.keys(data).forEach(key => {
                const input = document.querySelector(`[name="${key}"]`);
                if(!input) return;
                if(input.type === 'checkbox') {
                    const checks = document.querySelectorAll(`[name="${key}"]`);
                    checks.forEach(c => c.checked = data[key].includes(c.value));
                } else { input.value = data[key]; }
            });
            if(data.tem_checkin === 'Sim') toggleCheckin('Sim');
            if(data.tem_checkout === 'Sim') toggleCheckout('Sim');
        }

        function closeModal() {
            document.getElementById('loading-modal').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('success-state').classList.add('hidden');
        }

        const FICHA_CATEGORIAS = [
            { titulo: "Identifica√ß√£o do Im√≥vel", campos: ['cep', 'rua', 'bairro', 'cidade', 'numero', 'complemento', 'edificio', 'proprietario', 'configuracao'] },
            { titulo: "Equipamentos, Climatiza√ß√£o e Materiais", campos: ['aspirador', 'materiais_basicos', 'produtos_instrucao', 'proibidos', 'ventiladores'] },
            { titulo: "Quartos e Roupa de Cama", campos: ['guarda_enxoval', 'roupa_suja', 'montagem_camas'] },
            { titulo: "Banheiros e Amenities", campos: ['amenities', 'toalhas_posicao'] },
            { titulo: "Cozinha e Geladeira", campos: ['sobras_geladeira', 'equip', 'equip_outros', 'quantidades_louca', 'cozinha_extras'] },
            { titulo: "Finaliza√ß√£o e Detalhes", campos: ['sujeira_extrema', 'mimos', 'fechamento', 'lixo_descarte', 'obs_finais'] }
        ];

        // Atualizado com os novos campos
        const AGENDA_CATEGORIAS = [
            { titulo: "Informa√ß√µes Gerais e Hor√°rios", campos: ['cliente_tipo', 'condominio_torre', 'data_limpeza', 'horario_limpeza', 'tem_checkout', 'horario_checkout', 'tem_checkin', 'horario_checkin', 'num_pessoas', 'teve_pet'] },
            { titulo: "Acesso e Seguran√ßa", campos: ['entrada_metodo'] },
            { titulo: "Enxoval e Prepara√ß√£o", campos: ['toalhas_reserva', 'camas_preparo'] },
            { titulo: "Amenities e Mimos", campos: ['reposicao_banho', 'reposicao_mimos'] },
            { titulo: "Notas Especiais e Detalhes de Limpeza", campos: ['foco_video', 'obs_agendamento'] }
        ];

        const labelsMap = {
            'cep': 'CEP', 'rua': 'Logradouro', 'bairro': 'Bairro', 'cidade': 'Cidade/UF', 'numero': 'N¬∫', 'complemento': 'Complemento',
            'edificio': 'Edif√≠cio/Condom√≠nio', 'proprietario': 'Respons√°vel', 'configuracao': 'Configura√ß√£o do im√≥vel',
            'aspirador': 'Aspirador / Voltagem', 'materiais_basicos': 'Vassoura/Rodo/Balde', 'produtos_instrucao': 'Instru√ß√µes de Produtos',
            'proibidos': ' PROIBIDO USAR', 'ventiladores': 'Ventiladores', 'guarda_enxoval': 'Onde guardar limpos',
            'roupa_suja': 'Onde deixar sujos', 'montagem_camas': 'Padr√£o de camas', 'amenities': 'Amenities e Reposi√ß√£o',
            'toalhas_posicao': 'Toalhas limpas', 'sobras_geladeira': 'Sobras na geladeira', 'sujeira_extrema': 'Acordo sobre Sujeira Extrema',
            'equip': 'Eletrodom√©sticos', 'equip_outros': 'Outros Equipamentos', 'quantidades_louca': 'Quantidades (Pratos/Talheres)',
            'cozinha_extras': 'Detalhes Extras', 'mimos': 'Localiza√ß√£o Mimos', 'fechamento': 'Regras de Fechamento',
            'lixo_descarte': 'Descarte do Lixo', 'obs_finais': 'Observa√ß√µes Gerais',
            'cliente_tipo': 'J√° tem Ficha?', 'condominio_torre': 'Condom√≠nio e Apto', 'data_limpeza': 'Data Limpeza',
            'horario_limpeza': 'Hor√°rio Limpeza', 'tem_checkin': 'Novos h√≥spedes hoje?', 'horario_checkin': 'Hor√°rio Check-in',
            'tem_checkout': 'H√≥spedes saem hoje?', 'horario_checkout': 'Hor√°rio de Check-out', 'teve_pet': 'Houve Pet na √∫ltima reserva?',
            'entrada_metodo': 'Como ser√° a entrada?', 'num_pessoas': 'Qtd. Pessoas', 'toalhas_reserva': 'Toalhas Banho/Rosto',
            'camas_preparo': 'Preparo de Camas/Cobertores', 'reposicao_banho': 'Reposi√ß√£o Banheiro', 'reposicao_mimos': 'Reposi√ß√£o Mimos',
            'foco_video': 'Foco no V√≠deo de Prova de Limpeza', 'obs_agendamento': 'Pedido Especial'
        };

        // Fun√ß√£o para gerar o PDF nativo usando pdfmake
        async function generateReport(type) {
            const modal = document.getElementById('loading-modal');
            const loadState = document.getElementById('loading-state');
            const successState = document.getElementById('success-state');
            
            modal.classList.remove('hidden');
            loadState.classList.remove('hidden');
            successState.classList.add('hidden');

            const formId = type === 'ficha' ? 'form-ficha' : 'form-agenda';
            const formData = new FormData(document.getElementById(formId));
            
            const dataGeracao = `Gerado em: ${new Date().toLocaleDateString('pt-BR')}`;
            let pdfTitle = '';
            let pdfSubtitle = '';

            if(type === 'ficha') {
                pdfTitle = 'Ficha T√©cnica do Im√≥vel';
                pdfSubtitle = `Propriedade: ${formData.get('proprietario') || 'N√£o informada'}`;
            } else {
                pdfTitle = 'Solicita√ß√£o de Servi√ßo';
                let checkinData = formData.get('data_limpeza') ? new Date(formData.get('data_limpeza')).toLocaleDateString('pt-BR', {timeZone: 'UTC'}) : '-';
                let hrLimpeza = formData.get('horario_limpeza') || 'A combinar';
                pdfSubtitle = `Data: ${checkinData} | Hor√°rio: ${hrLimpeza}`;
            }

            // Defini√ß√£o da estrutura nativa do PDF (pdfmake)
            const docDefinition = {
                pageSize: 'A4',
                pageMargins: [40, 50, 40, 50],
                styles: {
                    header: { fontSize: 22, bold: true, color: '#0f172a', margin: [0, 0, 0, 4] },
                    subheader: { fontSize: 12, bold: true, color: '#0d9488', margin: [0, 0, 0, 20] },
                    alertBox: { fontSize: 10, bold: true, color: '#ef4444', alignment: 'center', margin: [0, 8, 0, 8] },
                    categoryTitle: { fontSize: 14, bold: true, color: '#0d9488', margin: [0, 20, 0, 6] },
                    fieldLabel: { fontSize: 9, bold: true, color: '#64748b', margin: [0, 0, 0, 3] },
                    fieldValue: { fontSize: 11, color: '#0f172a', margin: [0, 0, 0, 12], lineHeight: 1.2 },
                    fieldValueProibido: { fontSize: 11, bold: true, color: '#dc2626', margin: [0, 0, 0, 12], lineHeight: 1.2 },
                    footerText: { fontSize: 9, color: '#94a3b8', alignment: 'center', margin: [0, 20, 0, 0] }
                },
                content: [
                    // Caixa Vermelha de Alerta
                    {
                        table: {
                            widths: ['*'],
                            body: [
                                [{ text: 'DOCUMENTO V√ÅLIDO APENAS SE ENVIADO PARA SANDRA: (21) 96929-3505', style: 'alertBox' }]
                            ]
                        },
                        layout: {
                            hLineWidth: function() { return 1.5; },
                            vLineWidth: function() { return 1.5; },
                            hLineColor: function() { return '#ef4444'; },
                            vLineColor: function() { return '#ef4444'; },
                            hLineStyle: function() { return {dash: {length: 4, space: 4}}; },
                            vLineStyle: function() { return {dash: {length: 4, space: 4}}; }
                        },
                        margin: [0, 0, 0, 25]
                    },
                    // T√≠tulo e Data
                    {
                        columns: [
                            {
                                width: '*',
                                text: [
                                    { text: pdfTitle + '\n', style: 'header' },
                                    { text: pdfSubtitle, style: 'subheader' }
                                ]
                            },
                            {
                                width: 'auto',
                                text: dataGeracao,
                                alignment: 'right',
                                color: '#64748b',
                                fontSize: 10,
                                margin: [0, 10, 0, 0]
                            }
                        ],
                        margin: [0, 0, 0, 10]
                    },
                    // Linha divis√≥ria fina embaixo do t√≠tulo
                    {
                        canvas: [{ type: 'line', x1: 0, y1: 0, x2: 515, y2: 0, lineWidth: 2, lineColor: '#0d9488' }],
                        margin: [0, 0, 0, 10]
                    }
                ],
                // Rodap√© Din√¢mico
                footer: function(currentPage, pageCount) {
                    return {
                        text: 'Documento gerado digitalmente para garantir o padr√£o de qualidade e hospitalidade. P√°gina ' + currentPage.toString() + ' de ' + pageCount,
                        style: 'footerText'
                    };
                }
            };

            const categorias = type === 'ficha' ? FICHA_CATEGORIAS : AGENDA_CATEGORIAS;

            // Montando o corpo das respostas no PDF
            categorias.forEach(cat => {
                let catFieldsHtml = [];
                let currentRow = [];
                let hasData = false;

                cat.campos.forEach(campo => {
                    let val = '';
                    if(campo === 'equip') {
                        val = formData.getAll('equip').join(', ');
                    } else if(campo === 'data_limpeza') {
                         val = formData.get(campo) ? new Date(formData.get(campo)).toLocaleDateString('pt-BR', {timeZone: 'UTC'}) : '';
                    } else {
                        val = formData.get(campo);
                    }
                    
                    if(val && val.trim() !== "") {
                        hasData = true;
                        const isLongText = val.length > 50 || campo === 'equip' || campo === 'montagem_camas';
                        const styleName = campo === 'proibidos' ? 'fieldValueProibido' : 'fieldValue';
                        const labelText = (labelsMap[campo] || campo).toUpperCase();
                        
                        const block = [
                            { text: labelText, style: 'fieldLabel' },
                            { text: val.replace(/\n/g, '\n'), style: styleName }
                        ];

                        if (isLongText) {
                            // Se a linha atual tiver algo, empurra ela pro array principal antes do item longo
                            if (currentRow.length > 0) {
                                catFieldsHtml.push({ columns: currentRow, columnGap: 20 });
                                currentRow = [];
                            }
                            catFieldsHtml.push({ stack: block, margin: [0, 0, 0, 5] });
                        } else {
                            // Textos curtos dividem o espa√ßo em 2 colunas
                            currentRow.push({ stack: block, width: '*' });
                            if (currentRow.length === 2) {
                                catFieldsHtml.push({ columns: currentRow, columnGap: 20 });
                                currentRow = [];
                            }
                        }
                    }
                });

                // Se sobrou algum item sozinho na linha curta, fecha ela
                if (currentRow.length > 0) {
                    currentRow.push({ text: '', width: '*' }); // coluna fantasma para alinhar
                    catFieldsHtml.push({ columns: currentRow, columnGap: 20 });
                }

                // Se essa categoria teve respostas, joga no PDF
                if(hasData) {
                    docDefinition.content.push({ text: cat.titulo, style: 'categoryTitle' });
                    docDefinition.content.push({
                        canvas: [{ type: 'line', x1: 0, y1: 0, x2: 515, y2: 0, lineWidth: 1, lineColor: '#e2e8f0' }],
                        margin: [0, 0, 0, 12]
                    });
                    docDefinition.content = docDefinition.content.concat(catFieldsHtml);
                }
            });

            try {
                // Pequeno delay visual para UX
                await new Promise(r => setTimeout(r, 600));

                // GERA O PDF NATIVO
                pdfMake.createPdf(docDefinition).getBlob(async (blob) => {
                    const file = new File([blob], `Sandra_${type}_${Date.now()}.pdf`, { type: 'application/pdf' });

                    loadState.classList.add('hidden');
                    successState.classList.remove('hidden');

                    document.getElementById('btn-final-share').onclick = async () => {
                        // Verifica se o aparelho suporta envio do arquivo direto (celulares modernos)
                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    files: [file],
                                    title: `Documento Sandra - ${type.toUpperCase()}`,
                                    text: `Ol√° Sandra! Segue o meu documento gerado em PDF.\n*Documento v√°lido apenas se enviado para (21) 96929-3505*`
                                });
                            } catch (err) {
                                console.log("Compartilhamento cancelado ou falhou", err);
                            }
                        } else {
                            // Se estiver no PC ou navegador n√£o compat√≠vel com envio direto, baixa o arquivo
                            const link = document.createElement('a');
                            link.download = `Sandra_Documento_${type}.pdf`;
                            link.href = URL.createObjectURL(blob);
                            link.click();
                            alert("O seu dispositivo n√£o suporta o envio direto por este bot√£o. O PDF foi baixado no seu dispositivo, por favor envie-o como anexo para a Sandra no WhatsApp.");
                        }
                    };
                });
            } catch (err) {
                console.error("Erro ao gerar PDF", err);
                closeModal();
                alert("Ocorreu um erro ao gerar o documento. Tente novamente.");
            }
        }
    </script>
</body>
</html>

